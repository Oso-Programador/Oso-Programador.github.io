<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caja Móvil - TPV</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    /* Variables de Color */
    :root {
        --color-primary: #007bff; /* Azul fuerte para acciones */
        --color-secondary: #28a745; /* Verde para éxito/agregar */
        --color-danger: #dc3545; /* Rojo para eliminar */
        --color-background: #f4f7f6; /* Fondo muy claro */
        --color-surface: #ffffff; /* Blanco para contenedores */
        --color-text: #343a40; /* Gris oscuro para texto */
        --color-border: #dee2e6; /* Gris suave para bordes */
    }

    /* Estilos Base (Mobile-First) */
    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: var(--color-background);
        color: var(--color-text);
        line-height: 1.6;
        min-height: 100vh;
    }

    .container {
        width: 100%;
        max-width: 600px; /* Ancho máximo típico de móvil/tablet */
        margin: 0 auto;
        padding: 10px;
        box-sizing: border-box;
    }

    h1 {
        font-weight: 700;
        color: var(--color-primary);
        text-align: center;
        margin: 15px 0 20px;
    }

    h2 {
        font-weight: 600;
        color: var(--color-text);
        border-left: 5px solid var(--color-primary);
        padding-left: 10px;
        margin-top: 25px;
        margin-bottom: 15px;
        font-size: 1.4em;
    }

    /* Agrupación de Inputs y Botón de Agregar */
    .input-group {
        display: flex;
        flex-direction: column; /* Apilado en móviles */
        gap: 10px;
        padding: 15px;
        background-color: var(--color-surface);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    input[type="text"], input[type="number"] {
        padding: 12px;
        border: 1px solid var(--color-border);
        border-radius: 6px;
        font-size: 16px;
        width: 100%;
        box-sizing: border-box;
    }

    button {
        padding: 12px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.2s, transform 0.1s;
    }

    button:active {
        transform: scale(0.98);
    }

    #agregarProducto-btn {
        background-color: var(--color-secondary);
        color: var(--color-surface);
    }

    /* Carrito - Adaptación de Tabla para Móviles */
    .carrito-container {
        margin-top: 20px;
        padding: 15px;
        background-color: var(--color-surface);
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .producto-card {
        background: var(--color-background);
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.95em;
        border-left: 4px solid var(--color-primary);
    }

    .producto-info {
        flex-grow: 1;
        text-align: left;
    }
    
    .producto-info p {
        margin: 2px 0;
    }

    .producto-info .nombre {
        font-weight: 600;
        color: var(--color-text);
    }

    .producto-info .subtotal {
        font-weight: 700;
        color: var(--color-primary);
    }

    .delete-btn {
        background-color: var(--color-danger);
        color: var(--color-surface);
        padding: 8px 12px;
        font-size: 14px;
        line-height: 1;
        border-radius: 50%; /* Botón redondo para eliminar */
        width: 35px;
        height: 35px;
        flex-shrink: 0;
    }

    /* Resumen y Finalizar Venta */
    .total-summary {
        text-align: right;
        padding: 15px 0;
        font-size: 1.3em;
    }

    .total {
        font-weight: 700;
        color: var(--color-danger);
    }

    #generarTicket-btn {
        background-color: var(--color-primary);
        color: var(--color-surface);
        width: 100%;
        margin-top: 10px;
    }

    /* Ticket */
    #ticket {
        background: #e9f5ff; /* Azul muy claro para ticket */
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border: 1px dashed var(--color-primary);
    }
    
    /* Historial */
    .ventas {
        background: #e6ffec; /* Verde muy claro para historial */
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        border: 1px solid var(--color-secondary);
    }

    .venta-item {
        border-bottom: 1px solid #dcdcdc;
        padding: 8px 0;
    }

    /* Esconder la tabla HTML estándar que ya no usaremos */
    #tablaProductos { display: none; }


    /* Media Query para Tabletas/Escritorio (si fuera necesario, pero mantenemos el diseño vertical) */
    @media (min-width: 600px) {
        .container {
            padding: 20px;
        }
    }
</style>
</head>
<body>

<div class="container">
    <header>
        <h1>Caja Móvil <span role="img" aria-label="caja">💰</span></h1>
    </header>

    <h2>Agregar Producto</h2>
    <div class="input-group">
        <input type="text" id="nombre" placeholder="Nombre" aria-label="Nombre del producto">
        <input type="number" id="precio" placeholder="Precio ($)" min="0" step="0.01" aria-label="Precio">
        <input type="number" id="cantidad" placeholder="Cant." min="1" aria-label="Cantidad">
        <button onclick="agregarProducto()" id="agregarProducto-btn">Agregar al Carrito <span role="img" aria-label="más">+</span></button>
    </div>

    <div class="carrito-container">
        <h2>Carrito</h2>
        
        <div id="listaProductosMobile">
            <p style="text-align: center; color: #7f8c8d;">Agrega productos para empezar la venta.</p>
        </div>

        <div class="total-summary">
            <p>TOTAL: <span class="total">$<span id="total">0.00</span></span></p>
            <button onclick="generarTicket()" id="generarTicket-btn">Pagar y Generar Ticket <span role="img" aria-label="recibo">💳</span></button>
        </div>
    </div>
    
    <table id="tablaProductos"></table>

    <h2>Ticket Reciente</h2>
    <div id="ticket">
        <p style="text-align: center;">El ticket aparecerá aquí al finalizar la venta.</p>
    </div>

    <h2>Historial de Ventas</h2>
    <div id="historialVentas" class="ventas">
        <p>Cargando historial...</p>
    </div>
</div>

<script>
    let carrito = [];
    let ventas = JSON.parse(localStorage.getItem('ventas')) || [];

    // Función principal para agregar y manejar productos
    function agregarProducto() {
        const nombreInput = document.getElementById('nombre');
        const precioInput = document.getElementById('precio');
        const cantidadInput = document.getElementById('cantidad');

        const nombre = nombreInput.value.trim();
        const precio = parseFloat(precioInput.value);
        const cantidad = parseInt(cantidadInput.value);

        if (!nombre || isNaN(precio) || precio < 0 || isNaN(cantidad) || cantidad <= 0) {
            alert('Completa correctamente los campos: Nombre, Precio (>=0) y Cantidad (>=1).');
            return;
        }

        const productoExistente = carrito.find(p => p.nombre.toLowerCase() === nombre.toLowerCase());

        if (productoExistente) {
            productoExistente.cantidad += cantidad;
        } else {
            carrito.push({ nombre, precio, cantidad });
        }
        
        actualizarCarrito(); // Usamos esta función para actualizar ambas vistas
        limpiarInputs();
    }

    function actualizarCarrito() {
        let total = 0;
        const listaMobile = document.getElementById('listaProductosMobile');
        let productosHTML = [];

        if (carrito.length === 0) {
            listaMobile.innerHTML = '<p style="text-align: center; color: #7f8c8d;">Agrega productos para empezar la venta.</p>';
        } else {
            carrito.forEach((p, index) => {
                const subtotal = p.precio * p.cantidad;
                total += subtotal;
                
                productosHTML.push(`
                    <div class="producto-card">
                        <div class="producto-info">
                            <p class="nombre">${p.nombre}</p>
                            <p>${p.cantidad} x $${p.precio.toFixed(2)}</p>
                            <p class="subtotal">Subtotal: $${subtotal.toFixed(2)}</p>
                        </div>
                        <button onclick="eliminarProducto(${index})" class="delete-btn">X</button>
                    </div>
                `);
            });
            listaMobile.innerHTML = productosHTML.join('');
        }

        document.getElementById('total').innerText = total.toFixed(2);
    }

    function eliminarProducto(index) {
        if (confirm(`¿Eliminar ${carrito[index].nombre} del carrito?`)) {
            carrito.splice(index, 1);
            actualizarCarrito();
        }
    }

    function limpiarInputs() {
        document.getElementById('nombre').value = '';
        document.getElementById('precio').value = '';
        document.getElementById('cantidad').value = '';
        document.getElementById('nombre').focus();
    }

    function generarTicket() {
        if (carrito.length === 0) {
            alert('¡El carrito está vacío! Agrega productos para generar un ticket.');
            return;
        }

        const now = new Date();
        const fecha = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
        const total = document.getElementById('total').innerText;

        const productosList = carrito.map(p => 
            `<li>${p.cantidad} x ${p.nombre} - $${(p.precio * p.cantidad).toFixed(2)}</li>`
        ).join('');

        const ticketHTML = `
            <h3>*** COMPROBANTE DE VENTA ***</h3>
            <p><b>Fecha:</b> ${fecha}</p>
            <hr style="border-top: 1px dashed #ccc;">
            <ul>${productosList}</ul>
            <hr style="border-top: 2px solid var(--color-primary);">
            <p class="total" style="text-align: right; font-size: 1.3em;">TOTAL PAGADO: $${total}</p>
            <p style="text-align: center; margin-top: 15px; font-size: 0.9em;">¡Gracias por tu compra!</p>
        `;

        document.getElementById('ticket').innerHTML = ticketHTML;

        // Guardar venta
        ventas.unshift({ fecha, productos: carrito, total });
        localStorage.setItem('ventas', JSON.stringify(ventas));

        // Vaciar el carrito
        carrito = [];
        actualizarCarrito();
        mostrarHistorial();

        alert(`¡Venta finalizada! Total: $${total}`);
    }

    function mostrarHistorial() {
        const div = document.getElementById('historialVentas');
        if (ventas.length === 0) {
            div.innerHTML = '<p style="text-align: center; color: #7f8c8d;">No hay ventas registradas aún.</p>';
            return;
        }

        const historialReciente = ventas.slice(0, 5); 

        div.innerHTML = historialReciente.map(v => `
            <div class="venta-item">
                <p><b>Fecha:</b> ${v.fecha}</p>
                <p style="font-size: 0.9em;">Productos: ${v.productos.map(p => `${p.cantidad} x ${p.nombre}`).join(', ')}</p>
                <p class="total" style="color: var(--color-primary);"><b>Total:</b> $${v.total}</p>
            </div>
        `).join('');

        div.innerHTML += '<button onclick="limpiarHistorial()" style="background-color: #6c757d; color: white; width: 100%; margin-top: 10px;">Limpiar Historial</button>';
    }

    function limpiarHistorial() {
        if (confirm('¿Borrar PERMANENTEMENTE todo el historial de ventas?')) {
            localStorage.removeItem('ventas');
            ventas = [];
            mostrarHistorial();
        }
    }

    // Inicializar el carrito y el historial al cargar
    document.addEventListener('DOMContentLoaded', () => {
        actualizarCarrito();
        mostrarHistorial();
    });
</script>
</body>
</html>